#!/usr/bin/env bash
set -euo pipefail

echo "========================================"
echo "  Mojentic Python — Pre-Push Checks"
echo "========================================"

echo ""
echo "--- [1/4] flake8 (critical errors) ---"
uv run flake8 src --count --select=E9,F63,F7,F82 --show-source --statistics
echo "PASSED"

echo ""
echo "--- [2/4] pytest ---"
uv run pytest
echo "PASSED"

echo ""
echo "--- [3/4] bandit (security scan) ---"
uv run bandit -c .bandit -r src
echo "PASSED"

echo ""
echo "--- [4/4] pip-audit (dependency security) ---"
uv run pip-audit
echo "PASSED"

echo ""
echo "========================================"
echo "  All checks passed — push allowed"
echo "========================================"
